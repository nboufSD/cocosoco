(this.webpackJsonpcocosoco=this.webpackJsonpcocosoco||[]).push([[0],{28:function(e,t,n){e.exports=n.p+"static/media/Pointing.c29bd356.png"},29:function(e,t,n){e.exports=n.p+"static/media/AudioMuting.728874bb.svg"},30:function(e,t,n){e.exports=n.p+"static/media/AudioMutingDisabled.288ed0b3.svg"},31:function(e,t,n){e.exports=n.p+"static/media/CameraMuting.6dfcbc6b.svg"},32:function(e,t,n){e.exports=n.p+"static/media/CameraMutingDisabled.cd67b22a.svg"},33:function(e,t,n){e.exports=n.p+"static/media/CameraSwitching.e1a723d2.svg"},34:function(e,t,n){e.exports=n(79)},66:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){},72:function(e,t,n){},73:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){},79:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(11),c=n.n(i),o=n(6),u=n(9),s=n(24),l=n(19),d=n(25),p=n(13),f=n(5),m=n.n(f),v=n(7),b=n(26),h=n.n(b),O=n(27),j=-1;function y(){return g.apply(this,arguments)}function g(){return(g=Object(v.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,e.abrupt("return",t.filter((function(e){return"videoinput"===e.kind})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return k.apply(this,arguments)}function k(){return(k=Object(v.a)(m.a.mark((function e(){var t,n,r,a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return t=e.sent,n=j===t.length-1?0:j+1,r=t[n],a=r.deviceId,e.next=8,navigator.mediaDevices.getUserMedia({audio:!0,video:{deviceId:a}});case 8:return i=e.sent,j=n,e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=Object(O.actionCreatorFactory)(),_=I("ADD_PEER"),C=I.async("ADD_POINTING"),P=I.async("PARTICIPATE"),w=I("REMOVE_PEER"),x=I("REMOVE_POINTING"),N=I.async("SELECT_PEER"),M=I.async("SET_POINTING"),R=I.async("SWITCH_CAMERA"),A=I.async("TOGGLE_AUDIO_MUTING"),S=I.async("TOGGLE_CAMERA_MUTING"),T=I("ON_PEER_SELECTED"),D=new Map;function G(e,t,n){return function(){var r=Object(v.a)(m.a.mark((function r(a,i){var c,o;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:c={peerId:e,x:t,y:n};try{a(C.started(c)),clearTimeout(D.get(e)),o=setTimeout((function(){return a(x({peerId:e}))}),4e3),D.set(e,o),a(C.done({result:c,params:c}))}catch(i){a(C.failed({error:i,params:c}))}case 2:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()}function L(e,t,n){var r;(e(_({peerId:n.peerId,stream:n})),t.state.presenter)&&(null===(r=t.state.room)||void 0===r||r.send({type:"peer-selected",peerId:t.state.presenter.peerId}))}function U(e,t){switch(t.type){case"peer-selected":e(T({peerId:t.peerId}));break;case"pointing-added":e(G(t.peerId,t.x,t.y))}}var V=Object(d.reducerWithInitialState)({audiences:[],isAudioEnabled:!0,isCameraEnabled:!0,pointings:[]}).case(_,(function(e,t){var n=t.peerId,r={peerId:n,stream:t.stream},a=[].concat(Object(l.a)(e.audiences),[r]),i=e._selectedPeerId===n?r:e.presenter;return Object.assign({},e,{audiences:a,presenter:i})})).case(C.done,(function(e,t){var n=t.result,r=n.peerId,a=n.x,i=n.y,c=e.pointings.filter((function(e){return e.peerId!==r}));return Object.assign({},e,{pointings:[].concat(Object(l.a)(c),[{peerId:r,x:a,y:i}])})})).case(P.done,(function(e,t){var n=t.result,r=n.localPeer,a=n.localStream,i=n.room,c=[{peerId:r.id,stream:a}];return Object.assign({},e,{audiences:c,localPeer:r,localStream:a,room:i})})).case(w,(function(e,t){var n,r=t.peerId,a=e.audiences.filter((function(e){return e.peerId!==r})),i=(null===(n=e.presenter)||void 0===n?void 0:n.peerId)===r?null:e.presenter;return Object.assign({},e,{audiences:a,presenter:i})})).case(x,(function(e,t){var n=t.peerId,r=e.pointings.filter((function(e){return e.peerId!==n}));return Object.assign({},e,{pointings:r})})).case(R.done,(function(e,t){var n,r,a=t.result.localStream,i=null===(n=e.localPeer)||void 0===n?void 0:n.id,c=e.audiences.map((function(e){return e.peerId===i?{peerId:i,stream:a}:e})),o=(null===(r=e.presenter)||void 0===r?void 0:r.peerId)===i?{peerId:i,stream:a}:e.presenter;return Object.assign({},e,{audiences:c,localStream:a,presenter:o})})).case(A.done,(function(e,t){var n=t.result.isEnabled;return Object.assign({},e,{isAudioEnabled:n})})).case(S.done,(function(e,t){var n=t.result.isEnabled;return Object.assign({},e,{isCameraEnabled:n})})).case(T,(function(e,t){var n=t.peerId,r=e.audiences.find((function(e){return e.peerId===n}));return Object.assign({},e,{presenter:r,_selectedPeerId:n})})),W=Object(u.d)(Object(u.c)({state:V}),{},Object(u.a)(s.a)),H=n(1),F=n(2),J=n(4),B=n(3),X=n(8),Y=(n(66),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(e){var r;Object(H.a)(this,n),(r=t.call(this,e))._onClick=r._onClick.bind(Object(X.a)(r));var a=new URL(document.URL),i=a.searchParams.get("key"),c=a.searchParams.get("network"),o=a.searchParams.get("room"),u=null;return i&&c&&o?"sfu"!==c&&"mesh"!==c&&(u="Network should be 'sfu' or 'mesh'"):u="No specific key, network or room",r.state={key:i,network:c,room:o,error:u},r}return Object(F.a)(n,[{key:"_onClick",value:function(e){var t=this.props.participate,n=this.state,r=n.key,a=n.network,i=n.room;this.setState({isParticipating:!0}),t(r,a,i)}},{key:"render",value:function(){var e=this.state,t=e.room,n=e.error,r=e.isParticipating;return a.a.createElement("section",{className:"participation"},n?a.a.createElement("label",{className:"participation__error"},n):a.a.createElement("button",{className:"participation__button",onClick:this._onClick,disabled:r},a.a.createElement("label",null,"participate to "),a.a.createElement("label",{className:"participation__room"},t)))}}]),n}(a.a.PureComponent)),q=Object(o.b)(null,(function(e){return{participate:function(t,n,r){e(function(e,t,n){return function(){var r=Object(v.a)(m.a.mark((function r(a,i){var c,o,u,s,l;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c={key:e,network:t,roomId:n},r.prev=1,a(P.started(c)),r.next=5,E();case 5:return o=r.sent,r.next=8,new Promise((function(t){var n=new h.a({key:e});n.on("open",(function(){return t(n)}))}));case 8:u=r.sent,(s=u.joinRoom(n,{mode:t,stream:o})).on("peerLeave",(function(e){return a(w({peerId:e}))})),s.on("stream",(function(e){return L(a,i(),e)})),s.on("data",(function(e){var t=e.data;return U(a,t)})),l={localPeer:u,localStream:o,room:s},a(P.done({result:l,params:c})),r.next=20;break;case 17:r.prev=17,r.t0=r.catch(1),a(P.failed({error:r.t0,params:c}));case 20:case"end":return r.stop()}}),r,null,[[1,17]])})));return function(e,t){return r.apply(this,arguments)}}()}(t,n,r))}}}))(Y),z=(n(67),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(e){var r;return Object(H.a)(this,n),(r=t.call(this,e))._videoRef=a.a.createRef(),r._onClick=r._onClick.bind(Object(X.a)(r)),r}return Object(F.a)(n,[{key:"_onClick",value:function(e){var t=this.props,n=t.audience;(0,t.selectPeer)(n.peerId)}},{key:"_updateVideo",value:function(){var e=this._videoRef.current;if(e){var t=this.props.audience;e.srcObject=t.stream,e.playsInline=!0,e.play()}}},{key:"componentDidMount",value:function(){this._updateVideo()}},{key:"componentDidUpdate",value:function(){this._updateVideo()}},{key:"render",value:function(){var e=this.props,t=e.isMuted,n=e.isSelected;return a.a.createElement("li",{className:"audience-item "+(n?"audience-item--selected":""),onClick:this._onClick},a.a.createElement("video",{className:"audience-item__video",muted:t,ref:this._videoRef}))}}]),n}(a.a.PureComponent)),K=Object(o.b)(null,(function(e){return{selectPeer:function(t){e(function(e){return function(){var t=Object(v.a)(m.a.mark((function t(n,r){var a,i,c;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a={};try{n(N.started(a)),(c=null===(i=r())||void 0===i?void 0:i.state.room)&&(c.send({type:"peer-selected",peerId:e}),n(T({peerId:e}))),n(N.done({result:{},params:a}))}catch(o){n(N.failed({error:o,params:a}))}case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}(t))}}}))(z),Q=(n(68),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(F.a)(n,[{key:"render",value:function(){var e=this.props,t=e.audiences,n=e.localPeer,r=e.presenter;return a.a.createElement("ul",{className:"audience-list"},t.map((function(e){return a.a.createElement(K,{key:e.peerId,audience:e,isMuted:e.peerId===(null===n||void 0===n?void 0:n.id),isSelected:e.peerId===(null===r||void 0===r?void 0:r.peerId)})})))}}]),n}(a.a.PureComponent)),Z=Object(o.b)((function(e){return{audiences:e.state.audiences,localPeer:e.state.localPeer,presenter:e.state.presenter}}))(Q),$=n(28),ee=n.n($),te=(n(69),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(F.a)(n,[{key:"render",value:function(){var e=this.props,t=e.peerId,n=e.x,r=e.y,i=180*e.radian/Math.PI,c={left:"".concat(n,"px"),top:"".concat(r,"px"),transform:"translate(-60%, 0%) rotate(".concat(i,"deg) scale(").concat(i>0?-1:1,", 1)"),transformOrigin:"60% 0%"};return a.a.createElement("mark",{className:"pointing",style:c},a.a.createElement("img",{src:ee.a,alt:t,className:"pointing__image"}))}}]),n}(a.a.PureComponent)),ne=(n(70),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(e){var r;return Object(H.a)(this,n),(r=t.call(this,e))._videoRef=a.a.createRef(),r._onClick=r._onClick.bind(Object(X.a)(r)),r}return Object(F.a)(n,[{key:"_onClick",value:function(e){var t=e.target,n=e.layerX,r=e.layerY,a=n/t.clientWidth,i=r/t.clientHeight;this.props.setPointing(a,i)}},{key:"_renderPointings",value:function(){var e=this._videoRef.current;return e?this.props.pointings.map((function(t){var n=t.peerId,r=e.offsetLeft+e.clientWidth*t.x,i=e.offsetTop+e.clientHeight*t.y,c=Math.atan2(t.x-.5,-(t.y-.5));return a.a.createElement(te,{key:n,peerId:n,x:r,y:i,radian:c})})):null}},{key:"componentDidMount",value:function(){var e=this._videoRef.current;e&&e.addEventListener("click",this._onClick)}},{key:"componentDidUpdate",value:function(e){var t=this._videoRef.current;if(t){var n=this.props,r=n.localPeer,a=n.presenter;e.presenter!==a&&(a?(t.muted=(null===r||void 0===r?void 0:r.id)===a.peerId,t.srcObject=a.stream,t.playsInline=!0,t.play()):t.srcObject=null)}}},{key:"render",value:function(){return a.a.createElement("section",{className:"presenter"},a.a.createElement("video",{className:"presenter__video",ref:this._videoRef}),this._renderPointings())}}]),n}(a.a.PureComponent)),re=Object(o.b)((function(e){return{localPeer:e.state.localPeer,pointings:e.state.pointings,presenter:e.state.presenter}}),(function(e){return{setPointing:function(t,n){e(function(e,t){return function(){var n=Object(v.a)(m.a.mark((function n(r,a){var i,c,o,u,s,l;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i={};try{r(M.started(i)),u=null===(c=a())||void 0===c?void 0:c.state,(s=null===(o=u.localPeer)||void 0===o?void 0:o.id)&&(null===(l=u.room)||void 0===l||l.send({type:"pointing-added",peerId:s,x:e,y:t}),r(G(s,e,t))),r(M.done({result:{},params:i}))}catch(d){r(M.failed({error:d,params:i}))}case 2:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}(t,n))}}}))(ne),ae=n(29),ie=n.n(ae),ce=n(30),oe=n.n(ce),ue=(n(71),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(F.a)(n,[{key:"render",value:function(){var e=this.props.isAudioEnabled?ie.a:oe.a;return a.a.createElement("button",{onClick:this.props.toggleAudioMuting,className:"audio-muting"},a.a.createElement("img",{src:e,alt:"mute/unmute audio",className:"audio-muting__image"}))}}]),n}(a.a.PureComponent)),se=Object(o.b)((function(e){return{isAudioEnabled:e.state.isAudioEnabled}}),(function(e){return{toggleAudioMuting:function(){e(function(){var e=Object(v.a)(m.a.mark((function e(t,n){var r,a,i,c,o,u,s,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={};try{t(A.started(r)),i=null===(a=n())||void 0===a?void 0:a.state,c=!(null===i||void 0===i?void 0:i.isAudioEnabled),o=null===i||void 0===i?void 0:i.localStream,u=Object(p.a)((null===o||void 0===o?void 0:o.getAudioTracks())||[]);try{for(u.s();!(s=u.n()).done;)s.value.enabled=c}catch(d){u.e(d)}finally{u.f()}l={isEnabled:c},t(A.done({result:l,params:r}))}catch(f){t(A.failed({error:f,params:r}))}case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}}}))(ue),le=n(31),de=n.n(le),pe=n(32),fe=n.n(pe),me=(n(72),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(F.a)(n,[{key:"render",value:function(){var e=this.props.isCameraEnabled?de.a:fe.a;return a.a.createElement("button",{onClick:this.props.toggleCameraMuting,className:"camera-muting"},a.a.createElement("img",{src:e,alt:"mute/unmute camera",className:"camera-muting__image"}))}}]),n}(a.a.PureComponent)),ve=Object(o.b)((function(e){return{isCameraEnabled:e.state.isCameraEnabled}}),(function(e){return{toggleCameraMuting:function(){e(function(){var e=Object(v.a)(m.a.mark((function e(t,n){var r,a,i,c,o,u,s,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={};try{t(S.started(r)),i=null===(a=n())||void 0===a?void 0:a.state,c=!(null===i||void 0===i?void 0:i.isCameraEnabled),o=null===i||void 0===i?void 0:i.localStream,u=Object(p.a)((null===o||void 0===o?void 0:o.getVideoTracks())||[]);try{for(u.s();!(s=u.n()).done;)s.value.enabled=c}catch(d){u.e(d)}finally{u.f()}l={isEnabled:c},t(S.done({result:l,params:r}))}catch(f){t(S.failed({error:f,params:r}))}case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}}}))(me),be=n(33),he=n.n(be),Oe=(n(73),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(F.a)(n,[{key:"render",value:function(){return a.a.createElement("button",{onClick:this.props.switchCamera,className:"camera-switching"},a.a.createElement("img",{src:he.a,alt:"switch camera",className:"camera-switching__image"}))}}]),n}(a.a.PureComponent)),je=Object(o.b)(null,(function(e){return{switchCamera:function(){e(function(){var e=Object(v.a)(m.a.mark((function e(t,n){var r,a,i,c,o,u,s,l,d;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={},e.prev=1,t(R.started(r)),o=null===(a=n())||void 0===a?void 0:a.state,u=Object(p.a)((null===o||void 0===o||null===(c=o.localStream)||void 0===c?void 0:c.getTracks())||[]);try{for(u.s();!(s=u.n()).done;)s.value.enabled=!1}catch(f){u.e(f)}finally{u.f()}return e.next=8,E();case 8:l=e.sent,null===(i=null===o||void 0===o?void 0:o.room)||void 0===i||i.replaceStream(l),d={localStream:l},t(R.done({result:d,params:r})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),t(R.failed({error:e.t0,params:r}));case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t,n){return e.apply(this,arguments)}}())}}}))(Oe),ye=(n(74),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(F.a)(n,[{key:"render",value:function(){var e=this.props.children;return a.a.createElement("li",{className:"tool-item"},e)}}]),n}(a.a.PureComponent)),ge=(n(75),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(F.a)(n,[{key:"render",value:function(){return a.a.createElement("ul",{className:"tool-list"},a.a.createElement(ye,null,a.a.createElement(je,null)),a.a.createElement(ye,null,a.a.createElement(ve,null)),a.a.createElement(ye,null,a.a.createElement(se,null)))}}]),n}(a.a.PureComponent)),Ee=(n(76),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(F.a)(n,[{key:"render",value:function(){return a.a.createElement("section",{className:"room"},a.a.createElement(ge,null),a.a.createElement(re,null),a.a.createElement(Z,null))}}]),n}(a.a.PureComponent)),ke=(n(77),function(e){Object(J.a)(n,e);var t=Object(B.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(F.a)(n,[{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,this.props.room?a.a.createElement(Ee,null):a.a.createElement(q,null))}}]),n}(a.a.PureComponent)),Ie=Object(o.b)((function(e){return{room:e.state.room}}))(ke);n(78);c.a.render(a.a.createElement(o.a,{store:W},a.a.createElement(Ie,null)),document.getElementById("root"))}},[[34,1,2]]]);
//# sourceMappingURL=main.7e057c4b.chunk.js.map