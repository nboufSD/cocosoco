{"version":3,"sources":["components/Pointing.png","components/AudioMuting.svg","components/AudioMutingDisabled.svg","components/CameraMuting.svg","components/CameraMutingDisabled.svg","components/CameraSwitching.svg","lib/video.tsx","actions.ts","reducer.ts","store.ts","components/Participation.tsx","components/AudienceItem.tsx","components/AudienceList.tsx","components/Pointing.tsx","components/Presenter.tsx","components/AudioMuting.tsx","components/CameraMuting.tsx","components/CameraSwitching.tsx","components/ToolItem.tsx","components/ToolList.tsx","components/Room.tsx","components/App.tsx","index.tsx"],"names":["module","exports","currentIndex","getDevices","a","navigator","mediaDevices","enumerateDevices","devices","filter","device","kind","nextVideoStream","nextIndex","length","nextDevice","deviceId","getUserMedia","audio","video","stream","actionCreator","actionCreatorFactory","AddPeerAction","AddPointingAction","async","ParticipateAction","RemovePeerAction","RemovePointingAction","SelectPeerAction","SetPointintAcrion","SetTransformAcrion","SwitchCameraAction","ToggleAudioMutingAction","ToggleCameraMutingAction","OnPeerSelectedAction","OnTransformChangedAction","pointingTimerMap","Map","addPointing","peerId","x","y","dispatch","getState","params","started","clearTimeout","get","timerId","setTimeout","set","done","result","error","failed","onStream","store","state","presenter","room","send","type","onData","data","scale","initialState","audiences","isAudioEnabled","isCameraEnabled","pointings","transform","reducer","reducerWithInitialState","case","audience","_selectedPeerId","Object","assign","p","find","localPeer","localStream","id","map","isEnabled","createStore","combineReducers","applyMiddleware","thunk","Participation","props","_onClick","bind","url","URL","document","key","searchParams","network","e","participate","this","setState","isParticipating","className","onClick","disabled","React","PureComponent","connect","roomId","Promise","r","peer","Peer","on","joinRoom","mode","AudienceItem","_videoRef","createRef","selectPeer","current","srcObject","playsInline","play","_updateVideo","isMuted","isSelected","muted","ref","AudienceList","Pointing","angle","radian","Math","PI","styles","left","top","transformOrigin","videoStyles","style","src","logo","alt","Presenter","_panStopTimer","_onPanningStop","_onZoomChange","closest","test","userAgent","toLowerCase","target","layerX","layerY","clientWidth","clientHeight","setPointing","window","match","translate","translateMatch","positionX","parseFloat","positionY","area","_getVideoArea","setTransform","offsetLeft","offsetTop","atan2","addEventListener","prevProps","_amIPresenter","settings","_isMobile","onPanningStop","onZoomChange","pan","onPanning","doubleClick","_renderPointings","AudioMuting","logoEnabled","logoDisabled","toggleAudioMuting","getAudioTracks","enabled","CameraMuting","toggleCameraMuting","getVideoTracks","CameraSwitching","switchCamera","getTracks","replaceStream","ToolItem","children","ToolList","Room","App","Fragment","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.b1a80432.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/Pointing.c29bd356.png\";","module.exports = __webpack_public_path__ + \"static/media/AudioMuting.728874bb.svg\";","module.exports = __webpack_public_path__ + \"static/media/AudioMutingDisabled.288ed0b3.svg\";","module.exports = __webpack_public_path__ + \"static/media/CameraMuting.6dfcbc6b.svg\";","module.exports = __webpack_public_path__ + \"static/media/CameraMutingDisabled.cd67b22a.svg\";","module.exports = __webpack_public_path__ + \"static/media/CameraSwitching.e1a723d2.svg\";","let currentIndex = -1;\n\nasync function getDevices() {\n  const devices = await navigator.mediaDevices.enumerateDevices();\n  return devices.filter(device => device.kind === \"videoinput\");\n}\n\nexport async function nextVideoStream() {\n  const devices = await getDevices();\n\n  const nextIndex = currentIndex === devices.length -1 ? 0 : currentIndex + 1;\n  const nextDevice = devices[nextIndex];\n\n  const deviceId = nextDevice.deviceId;\n  const stream = await navigator.mediaDevices.getUserMedia({\n    audio: true,\n    video: { deviceId },\n  });\n\n  currentIndex = nextIndex;\n\n  return stream;\n}\n","import { AnyAction } from \"redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n\nimport Peer from \"skyway-js\";\nimport { actionCreatorFactory } from \"../node_modules/typescript-fsa\";\n\nimport { nextVideoStream } from \"./lib/video\";\nimport { TStore } from \"./store\";\n\nconst actionCreator = actionCreatorFactory()\n\nexport const AddPeerAction = actionCreator<{ peerId: string, stream: any }>(\"ADD_PEER\");\nexport const AddPointingAction = actionCreator.async<\n  { peerId: string, x: number, y: number },\n  { peerId: string, x: number, y: number },\n  { error: any }\n>(\"ADD_POINTING\");\nexport const ParticipateAction = actionCreator.async<\n  {}, { localPeer: Peer, localStream: MediaStream, room: any }, { error: any }\n>(\"PARTICIPATE\");\nexport const RemovePeerAction = actionCreator<{ peerId: string }>(\"REMOVE_PEER\");\nexport const RemovePointingAction = actionCreator<{ peerId: string }>(\"REMOVE_POINTING\");\nexport const SelectPeerAction = actionCreator.async<{}, {}, { error: any }>(\"SELECT_PEER\");\nexport const SetPointintAcrion = actionCreator.async<{}, {}, { error: any }>(\"SET_POINTING\");\nexport const SetTransformAcrion = actionCreator.async<{}, {}, { error: any }>(\"SET_TRANSFORM\");\nexport const SwitchCameraAction = actionCreator.async<\n  {}, { localStream: MediaStream }, { error: any }\n>(\"SWITCH_CAMERA\");\nexport const ToggleAudioMutingAction = actionCreator.async<\n  {}, { isEnabled: boolean }, { error: any }\n>(\"TOGGLE_AUDIO_MUTING\");\nexport const ToggleCameraMutingAction = actionCreator.async<\n  {}, { isEnabled: boolean }, { error: any }\n>(\"TOGGLE_CAMERA_MUTING\");\nexport const OnPeerSelectedAction =\n  actionCreator<{ peerId: string }>(\"ON_PEER_SELECTED\");\nexport const OnTransformChangedAction =\n  actionCreator<{ x: number, y: number, scale: number  }>(\"ON_TRANSFORM_CHANGED\");\n\nconst pointingTimerMap = new Map();\n\nexport function participate(key: string, network: \"mesh\" | \"sfu\", roomId: string) {\n  return async (dispatch: ThunkDispatch<TStore, void, AnyAction>, getState: () => TStore) => {\n    const params = { key, network, roomId };\n    try {\n      dispatch(ParticipateAction.started(params));\n\n      const localStream = await nextVideoStream();\n      const localPeer: Peer = await new Promise(r => {\n        const peer = new Peer({ key: key });\n        peer.on(\"open\", () => r(peer));\n      });\n\n      const room = localPeer.joinRoom(roomId, {\n        mode: network,\n        stream: localStream\n      });\n\n      room.on(\"peerLeave\", peerId => dispatch(RemovePeerAction({ peerId })));\n      room.on(\"stream\", stream => onStream(dispatch, getState(), stream));\n      room.on(\"data\", ({ data }) => onData(dispatch, data));\n\n      const result = {\n        localPeer,\n        localStream,\n        room,\n      };\n\n      dispatch(ParticipateAction.done({ result, params }));\n    } catch (error) {\n      dispatch(ParticipateAction.failed({ error, params }));\n    }\n  }\n}\n\nfunction addPointing(peerId: string, x: number, y: number) {\n  return async (dispatch: ThunkDispatch<TStore, void, AnyAction>, getState: () => TStore) => {\n    const params = { peerId, x, y };\n\n    try {\n      dispatch(AddPointingAction.started(params));\n\n      clearTimeout(pointingTimerMap.get(peerId));\n      const timerId = setTimeout(() => dispatch(RemovePointingAction({ peerId })), 4000);\n      pointingTimerMap.set(peerId, timerId);\n\n      dispatch(AddPointingAction.done({ result: params, params }));\n    } catch (error) {\n      dispatch(AddPointingAction.failed({ error, params }));\n    }\n  }\n}\n\nexport function selectPeer(peerId: string) {\n  return async (dispatch: ThunkDispatch<TStore, void, AnyAction>, getState: () => TStore) => {\n    const params = {};\n\n    try {\n      dispatch(SelectPeerAction.started(params));\n\n      const room = getState()?.state.room;\n      if (room) {\n        room.send({ type: \"peer-selected\", peerId });\n        // As the room.send does not send to the local peer, update manually.\n        dispatch(OnPeerSelectedAction({ peerId }));\n      }\n\n      dispatch(SelectPeerAction.done({ result: {}, params }));\n    } catch (error) {\n      dispatch(SelectPeerAction.failed({ error, params }));\n    }\n  }\n}\n\nexport function setPointing(x: number, y: number) {\n  return async (dispatch: ThunkDispatch<TStore, void, AnyAction>, getState: () => TStore) => {\n    const params = {};\n\n    try {\n      dispatch(SetPointintAcrion.started(params));\n\n      const state = getState()?.state;\n\n      const peerId = state.localPeer?.id;\n\n      if (peerId) {\n        state.room?.send({ type: \"pointing-added\", peerId, x, y });\n        // As the room.send does not send to the local peer, update manually.\n        dispatch(addPointing(peerId, x, y));\n      }\n\n      dispatch(SetPointintAcrion.done({ result: {}, params }));\n    } catch (error) {\n      dispatch(SetPointintAcrion.failed({ error, params }));\n    }\n  }\n}\n\nexport function setTransform(x: number, y: number, scale: number) {\n  return async (dispatch: ThunkDispatch<TStore, void, AnyAction>, getState: () => TStore) => {\n    const params = {};\n\n    try {\n      dispatch(SetTransformAcrion.started(params));\n\n      const state = getState()?.state;\n      state.room?.send({ type: \"transform-changed\", x, y, scale });\n\n      dispatch(SetTransformAcrion.done({ result: {}, params }));\n    } catch (error) {\n      dispatch(SetTransformAcrion.failed({ error, params }));\n    }\n  }\n}\n\nexport function switchCamera() {\n  return async (dispatch: ThunkDispatch<TStore, void, AnyAction>, getState: () => TStore) => {\n    const params = {};\n\n    try {\n      dispatch(SwitchCameraAction.started(params));\n\n      const state = getState()?.state;\n\n      // Close previouse stream.\n      for (const track of state?.localStream?.getTracks() || []) {\n        track.enabled = false;\n      }\n\n      const localStream = await nextVideoStream();\n\n      // parameter of replaceStream is defined as MediaSource, but localStream is MediaStream.\n      // I don't know why..\n      (state?.room as any)?.replaceStream(localStream);\n\n      const result = { localStream };\n\n      dispatch(SwitchCameraAction.done({ result, params }));\n    } catch (error) {\n      dispatch(SwitchCameraAction.failed({ error, params }));\n    }\n  }\n}\n\nexport function toggleAudioMuting() {\n  return async (dispatch: ThunkDispatch<TStore, void, AnyAction>, getState: () => TStore) => {\n    const params = {};\n\n    try {\n      dispatch(ToggleAudioMutingAction.started(params));\n\n      const state = getState()?.state;\n      const isEnabled = !state?.isAudioEnabled;\n      const localStream = state?.localStream;\n\n      for (const track of localStream?.getAudioTracks() || []) {\n        track.enabled = isEnabled;\n      }\n\n      const result = { isEnabled };\n\n      dispatch(ToggleAudioMutingAction.done({ result, params }));\n    } catch (error) {\n      dispatch(ToggleAudioMutingAction.failed({ error, params }));\n    }\n  }\n}\n\nexport function toggleCameraMuting() {\n  return async (dispatch: ThunkDispatch<TStore, void, AnyAction>, getState: () => TStore) => {\n    const params = {};\n\n    try {\n      dispatch(ToggleCameraMutingAction.started(params));\n\n      const state = getState()?.state;\n      const isEnabled = !state?.isCameraEnabled;\n      const localStream = state?.localStream;\n\n      for (const track of localStream?.getVideoTracks() || []) {\n        track.enabled = isEnabled;\n      }\n\n      const result = { isEnabled };\n\n      dispatch(ToggleCameraMutingAction.done({ result, params }));\n    } catch (error) {\n      dispatch(ToggleCameraMutingAction.failed({ error, params }));\n    }\n  }\n}\n\nfunction onStream(dispatch: ThunkDispatch<TStore, void, AnyAction>, store: TStore, stream: any) {\n  dispatch(AddPeerAction({ peerId: stream.peerId, stream }));\n  // Tell who is a presenter now, to peer joined newly.\n  if (store.state.presenter) {\n    store.state.room?.send({ type: \"peer-selected\", peerId: store.state.presenter.peerId });\n  }\n}\n\nfunction onData(dispatch: ThunkDispatch<TStore, void, AnyAction>, data: any) {\n  switch (data.type) {\n    case \"peer-selected\": {\n      dispatch(OnPeerSelectedAction({ peerId: data.peerId }));\n      break;\n    }\n    case \"pointing-added\": {\n      dispatch(addPointing(data.peerId, data.x, data.y));\n      break;\n    }\n    case \"transform-changed\": {\n      dispatch(OnTransformChangedAction({ x: data.x, y: data.y, scale: data.scale }));\n      break;\n    }\n  }\n}\n","import { reducerWithInitialState } from \"typescript-fsa-reducers\";\n\nimport {\n  AddPeerAction,\n  AddPointingAction,\n  ParticipateAction,\n  RemovePeerAction,\n  RemovePointingAction,\n  SwitchCameraAction,\n  ToggleAudioMutingAction,\n  ToggleCameraMutingAction,\n  OnPeerSelectedAction,\n  OnTransformChangedAction,\n} from \"./actions\";\nimport { Member, Pointing, Transform } from \"./types\";\n\nexport interface IState {\n  audiences: Member[],\n  isAudioEnabled: boolean,\n  isCameraEnabled: boolean,\n  localPeer?: Peer,\n  localStream?: MediaStream,\n  room?: SFURoom | MeshRoom,\n  pointings: Pointing[],\n  presenter?: Member,\n  transform: Transform,\n  // Don't use this. The reason why we need this variable is because the `peer-selected`\n  // event and AddPeerAction timing after joining the room is racing.\n  _selectedPeerId?: string,\n}\n\nconst initialState: IState = {\n  audiences: [],\n  isAudioEnabled: true,\n  isCameraEnabled: true,\n  pointings: [],\n  transform: { x: 0, y: 0, scale: 1 },\n}\n\nexport const reducer = reducerWithInitialState(initialState)\n  .case(AddPeerAction, (state, { peerId, stream }) => {\n    const audience = { peerId, stream };\n    const audiences = [...state.audiences, audience];\n\n    // As the presenter peer joined after firing `peer-selected` event, set as a presenter.\n    const presenter = state._selectedPeerId === peerId ? audience : state.presenter;\n    const transform = presenter === state.presenter ? state.transform : initialState.transform;\n\n    return Object.assign({}, state, { audiences, presenter, transform });\n  })\n  .case(AddPointingAction.done, (state, { result }) => {\n    const { peerId, x, y } = result;\n    const pointings = state.pointings.filter(p => p.audience.peerId !== peerId);\n    const audience = state.audiences.find(a => a.peerId === peerId);\n\n    return Object.assign({}, state, { pointings: [...pointings, { audience, x, y }] });\n  })\n  .case(ParticipateAction.done, (state, { result }) => {\n    const { localPeer, localStream, room } = result;\n\n    const audience = {\n      peerId: localPeer.id,\n      stream: localStream,\n    };\n    const audiences = [audience];\n\n    return Object.assign({}, state, { audiences, localPeer, localStream, room });\n  })\n  .case(RemovePeerAction, (state, { peerId }) => {\n    const audiences = state.audiences.filter(a => a.peerId !== peerId);\n    const presenter = state.presenter?.peerId === peerId ? null : state.presenter;\n\n    return Object.assign({}, state, { audiences, presenter });\n  })\n  .case(RemovePointingAction, (state, { peerId }) => {\n    const pointings = state.pointings.filter(p => p.audience.peerId !== peerId);\n\n    return Object.assign({}, state, { pointings });\n  })\n  .case(SwitchCameraAction.done, (state, { result }) => {\n    const { localStream } = result;\n    const peerId = state.localPeer?.id;\n\n    const audiences = state.audiences.map(\n      a => a.peerId === peerId ? { peerId, stream: localStream } : a\n    );\n\n    const presenter = state.presenter?.peerId === peerId\n                        ? { peerId, stream: localStream }\n                        : state.presenter;\n\n    return Object.assign({}, state, { audiences, localStream, presenter });\n  })\n  .case(ToggleAudioMutingAction.done, (state, { result }) => {\n    const { isEnabled } = result;\n\n    return Object.assign({}, state, { isAudioEnabled: isEnabled });\n  })\n  .case(ToggleCameraMutingAction.done, (state, { result }) => {\n    const { isEnabled } = result;\n\n    return Object.assign({}, state, { isCameraEnabled: isEnabled });\n  })\n  .case(OnPeerSelectedAction, (state, { peerId }) => {\n    const presenter = state.audiences.find(a => a.peerId === peerId);\n\n    return Object.assign({}, state, {\n      presenter,\n      transform: initialState.transform,\n      _selectedPeerId: peerId,\n    });\n  })\n  .case(OnTransformChangedAction, (state, { x, y, scale }) => {\n    return Object.assign({}, state, { transform: { x, y, scale } });\n  })\n","import { combineReducers, createStore, applyMiddleware} from \"redux\";\nimport thunk from \"redux-thunk\";\nimport { reducer, IState } from \"./reducer\";\n\nexport type TStore = {\n  state: IState\n}\n\nexport const store = createStore(\n  combineReducers<TStore>({\n    state: reducer\n  }),\n  {},\n  applyMiddleware(thunk)\n);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { participate } from \"../actions\"\n\nimport \"./Participation.css\";\n\ninterface IProps {\n  participate: any\n}\n\ninterface IState {\n  key: string | null,\n  network: string | null,\n  room: string | null,\n  error: string | null,\n  isParticipating?: boolean,\n}\n\nclass Participation extends React.PureComponent<IProps, IState> {\n  constructor(props: IProps) {\n    super(props);\n\n    this._onClick = this._onClick.bind(this);\n\n    const url = new URL(document.URL);\n    const key = url.searchParams.get(\"key\");\n    const network = url.searchParams.get(\"network\");\n    const room = url.searchParams.get(\"room\");\n\n    let error = null;\n    if (!key || !network || !room) {\n      error = \"No specific key, network or room\"\n    } else if (network !== \"sfu\" && network !== \"mesh\") {\n      error = \"Network should be 'sfu' or 'mesh'\";\n    }\n\n    this.state = { key, network, room, error };\n  }\n\n  _onClick(e: React.MouseEvent) {\n    const { participate } = this.props;\n    const { key, network, room } = this.state;\n    this.setState({ isParticipating: true });\n    participate(key, network, room);\n  }\n\n  render() {\n    const { room, error, isParticipating } = this.state;\n\n    return (\n      <section className=\"participation\">\n        {\n          error\n            ? <label className=\"participation__error\">{ error }</label>\n            : <button\n                className=\"participation__button\"\n                onClick={this._onClick}\n                disabled={isParticipating}\n              >\n                <label>participate to </label>\n                <label className=\"participation__room\">{ room }</label>\n              </button>\n        }\n      </section>\n    );\n  }\n}\n\nconst mapDispatchToProps = (dispatch: ThunkDispatch<TStore, void, AnyAction>) => ({\n  participate: (key: string, network: \"mesh\" | \"sfu\", room: string) => {\n    dispatch(participate(key, network, room));\n  },\n});\n\nexport default connect(null, mapDispatchToProps)(Participation);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { selectPeer } from \"../actions\"\nimport { Member } from \"../types\";\n\nimport \"./AudienceItem.css\";\n\ninterface IProps {\n  audience: Member,\n  isMuted: boolean,\n  isSelected: boolean,\n  selectPeer: any,\n}\n\nclass AudienceItem extends React.PureComponent<IProps> {\n  // As video.playsInline is not defined in HTMLVideoElement, add \"any\" as well.\n  private _videoRef = React.createRef<HTMLVideoElement | any>();\n\n  constructor(props: IProps) {\n    super(props);\n\n    this._onClick = this._onClick.bind(this);\n  }\n\n  _onClick(e: React.MouseEvent) {\n    const { audience, selectPeer } = this.props;\n    selectPeer(audience.peerId);\n  }\n\n  _updateVideo() {\n    const video = this._videoRef.current;\n    if (!video) {\n      return;\n    }\n\n    const { audience } = this.props;\n    video.srcObject = audience.stream;\n    video.playsInline = true;\n    video.play();\n  }\n\n  componentDidMount() {\n    this._updateVideo();\n  }\n\n  componentDidUpdate() {\n    this._updateVideo();\n  }\n\n  render() {\n    const { isMuted, isSelected } = this.props;\n\n    return (\n      <li\n        className={\"audience-item \" + (isSelected ? \"audience-item--selected\" : \"\")}\n        onClick={ this._onClick }\n      >\n        <video className=\"audience-item__video\" muted={isMuted} ref={this._videoRef}></video>\n      </li>\n    );\n  }\n}\n\nconst mapDispatchToProps = (dispatch: ThunkDispatch<TStore, void, AnyAction>) => ({\n  selectPeer: (peerId: string) => {\n    dispatch(selectPeer(peerId));\n  },\n});\n\nexport default connect(null, mapDispatchToProps)(AudienceItem);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\n\nimport { TStore } from \"../store\";\nimport { Member } from \"../types\";\n\nimport AudienceItem from \"./AudienceItem\";\n\nimport \"./AudienceList.css\";\n\ninterface IProps {\n  audiences: Member[],\n  localPeer?: Peer,\n  presenter?: Member,\n}\n\nclass AudienceList extends React.PureComponent<IProps> {\n  render() {\n    const { audiences, localPeer, presenter } = this.props;\n\n    return (\n      <ul className=\"audience-list\">\n        {\n          audiences.map(audience =>\n            <AudienceItem\n              key={ audience.peerId }\n              audience={ audience }\n              isMuted={ audience.peerId === localPeer?.id }\n              isSelected={ audience.peerId === presenter?.peerId }\n            />\n          )\n        }\n      </ul>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    audiences: store.state.audiences,\n    localPeer: store.state.localPeer,\n    presenter: store.state.presenter,\n  }\n}\n\nexport default connect(mapStateToProps)(AudienceList);\n","import React from \"react\";\n\nimport logo from './Pointing.png';\nimport \"./Pointing.css\";\nimport { Member } from \"../types\";\n\ninterface IProps {\n  audience: Member,\n  x: number,\n  y: number,\n  radian: number,\n}\n\nclass Pointing extends React.PureComponent<IProps> {\n  // As video.playsInline is not defined in HTMLVideoElement, add \"any\" as well.\n  private _videoRef = React.createRef<HTMLVideoElement | any>();\n\n  _updateVideo() {\n    const video = this._videoRef.current;\n    if (!video) {\n      return;\n    }\n\n    const { audience } = this.props;\n    video.srcObject = audience.stream;\n    video.playsInline = true;\n    video.play();\n  }\n\n  componentDidMount() {\n    this._updateVideo();\n  }\n\n  componentDidUpdate() {\n    this._updateVideo();\n  }\n\n  render() {\n    const { audience, x, y, radian } = this.props;\n\n    const angle = radian * 180 / Math.PI;\n    const styles = {\n      left: `${ x }px`,\n      top: `${ y }px`,\n      transform: `translate(-60%, 0%) rotate(${angle}deg) scale(${angle > 0 ? -1 : 1}, 1)`,\n      transformOrigin: \"60% 0%\",\n    };\n\n    const videoStyles = {\n      transform: `scale(${angle > 0 ? -1 : 1}, 1) rotate(${-angle}deg)`,\n      transformOrigin: \"50%\",\n    };\n\n    return (\n      <mark className=\"pointing\" style={styles}>\n        <img className=\"pointing__image\" src={logo} alt={audience.peerId} />\n        <div className=\"pointing__audience\">\n          <video className=\"pointing__audience__video\" style={videoStyles} muted={true} ref={this._videoRef}></video>\n        </div>\n      </mark>\n    );\n  }\n}\n\nexport default Pointing;\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TransformWrapper, TransformComponent } from \"react-zoom-pan-pinch\";\n\nimport { TStore } from \"../store\";\nimport { Member, Pointing, Transform } from \"../types\";\nimport { setPointing, setTransform } from \"../actions\"\nimport PointingComponent from \"./Pointing\";\n\nimport \"./Presenter.css\";\n\ninterface IProps {\n  localPeer?: Peer,\n  pointings: Pointing[],\n  presenter?: Member,\n  transform: Transform,\n  setPointing: any,\n  setTransform: any,\n}\n\nclass Presenter extends React.PureComponent<IProps> {\n  // As video.playsInline is not defined in HTMLVideoElement, add \"any\" as well.\n  private _videoRef = React.createRef<HTMLVideoElement | any>();\n\n  private _panStopTimer = 0;\n\n  constructor(props: IProps) {\n    super(props);\n\n    this._onClick = this._onClick.bind(this);\n    this._onPanningStop = this._onPanningStop.bind(this);\n    this._onZoomChange = this._onZoomChange.bind(this);\n  }\n\n  _amIPresenter() {\n    const { localPeer, presenter } = this.props;\n\n    if (!localPeer || !presenter) {\n      return false;\n    }\n\n    return localPeer.id === presenter.peerId;\n  }\n\n  _getVideoArea() {\n    const video = this._videoRef.current;\n    return video?.closest(\".react-transform-component\");\n  }\n\n  _isMobile() {\n    return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());\n  }\n\n  _onClick(e: any) {\n    const { target, layerX, layerY } = e;\n    const { clientWidth, clientHeight } = target;\n    const x = layerX / clientWidth;\n    const y = layerY / clientHeight;\n    this.props.setPointing(x, y);\n  }\n\n  /**\n   * NOTE: This function is for following issue.\n   * After fixing following issue, need to address for it.\n   * https://github.com/prc5/react-zoom-pan-pinch/issues/89\n   */\n  _onPanningStop(e: any) {\n    this._panStopTimer = window.setTimeout(() => {\n      const video = this._videoRef.current;\n      if (!video) {\n        return;\n      }\n\n      const transformElement = video.closest(\".react-transform-element\");\n      const transform = transformElement.style.transform.match(/translate\\((.*)\\) scale\\((.*)\\)/);\n      const translate = transform[1];\n      const translateMatch = translate.match(/(.*), (.*)/);\n      const positionX = parseFloat(translateMatch ? translateMatch[1] : translate);\n      const positionY = parseFloat(\n        translateMatch && translateMatch.length === 3 ? translateMatch[2] : 0\n      );\n      const scale = parseFloat(transform[2]);\n      this._onZoomChange({ positionX, positionY, scale });\n    }, 500);\n  }\n\n  _onZoomChange(e: any) {\n    window.clearTimeout(this._panStopTimer);\n\n    const area = this._getVideoArea();\n    const { positionX, positionY, scale } = e;\n    const { clientWidth, clientHeight } = area;\n    const x = positionX / clientWidth;\n    const y = positionY / clientHeight;\n    this.props.setTransform(x, y, scale);\n  }\n\n  _renderPointings() {\n    const area = this._getVideoArea();\n    if (!area) {\n      return null;\n    }\n\n    const { pointings } = this.props;\n    return pointings.map(p => {\n      const audience = p.audience;\n      const x = area.offsetLeft + area.clientWidth * p.x;\n      const y = area.offsetTop + area.clientHeight * p.y;\n      const radian = Math.atan2(p.x - 0.5, -(p.y - 0.5));\n\n      return <PointingComponent key={audience.peerId} audience={audience} x={x} y={y} radian={radian}/>;\n    });\n  }\n\n  componentDidMount() {\n    const area = this._getVideoArea();\n    if (!area) {\n      return null;\n    }\n\n    // We can't get layerX/layerY from React mouse event.\n    area.addEventListener(\"click\", this._onClick);\n  }\n\n  componentDidUpdate(prevProps: IProps) {\n    const video = this._videoRef.current;\n    if (!video) {\n      return;\n    }\n\n    const { presenter } = this.props;\n    if (prevProps.presenter === presenter) {\n      return;\n    }\n\n    if (presenter) {\n      video.muted = this._amIPresenter();\n      video.srcObject = presenter.stream;\n      video.playsInline = true;\n      video.play();\n    } else {\n      video.srcObject = null;\n    }\n  }\n\n  render() {\n    const area = this._getVideoArea();\n\n    const settings = this._amIPresenter() && this._isMobile()\n      ? {\n        onPanningStop: this._onPanningStop,\n        onZoomChange: this._onZoomChange,\n        pan: {\n          disabled: false,\n        },\n      }\n      : {\n        positionX: area?.clientWidth * this.props.transform.x,\n        positionY: area?.clientHeight * this.props.transform.y,\n        scale: this.props.transform.scale,\n        pan: {\n          disabled: true,\n        },\n      };\n\n    return (\n      <section className=\"presenter\">\n        <TransformWrapper\n          onPanning={settings.onZoomChange}\n          onPanningStop={settings.onPanningStop}\n          onZoomChange={settings.onZoomChange}\n          positionX={settings.positionX}\n          positionY={settings.positionY}\n          scale={settings.scale}\n          pan={settings.pan}\n          doubleClick={{ disabled: true }}\n        >\n          <TransformComponent>\n            <video className=\"presenter__video\" ref={this._videoRef}></video>\n          </TransformComponent>\n        </TransformWrapper>\n        { this._renderPointings() }\n      </section>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    localPeer: store.state.localPeer,\n    pointings: store.state.pointings,\n    presenter: store.state.presenter,\n    transform: store.state.transform,\n  }\n}\n\nconst mapDispatchToProps = (dispatch: ThunkDispatch<TStore, void, AnyAction>) => ({\n  setPointing: (x: number, y: number) => {\n    dispatch(setPointing(x, y));\n  },\n  setTransform: (x: number, y: number, scale: number) => {\n    dispatch(setTransform(x, y, scale));\n  },\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Presenter);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { toggleAudioMuting } from \"../actions\"\n\nimport logoEnabled from \"./AudioMuting.svg\";\nimport logoDisabled from \"./AudioMutingDisabled.svg\";\nimport \"./AudioMuting.css\";\n\ninterface IProps {\n  isAudioEnabled: boolean,\n  toggleAudioMuting: any,\n}\n\nclass AudioMuting extends React.PureComponent<IProps> {\n  render() {\n    const { isAudioEnabled } = this.props;\n    const logo = isAudioEnabled ? logoEnabled : logoDisabled;\n\n    return (\n      <button onClick={this.props.toggleAudioMuting} className=\"audio-muting\">\n        <img src={logo} alt=\"mute/unmute audio\" className=\"audio-muting__image\" />\n      </button>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    isAudioEnabled: store.state.isAudioEnabled,\n  }\n}\n\nconst mapDispatchToProps = (dispatch: ThunkDispatch<TStore, void, AnyAction>) => ({\n  toggleAudioMuting: () => {\n    dispatch(toggleAudioMuting());\n  },\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AudioMuting);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { toggleCameraMuting } from \"../actions\"\n\nimport logoEnabled from \"./CameraMuting.svg\";\nimport logoDisabled from \"./CameraMutingDisabled.svg\";\nimport \"./CameraMuting.css\";\n\ninterface IProps {\n  isCameraEnabled: boolean,\n  toggleCameraMuting: any,\n}\n\nclass CameraMuting extends React.PureComponent<IProps> {\n  render() {\n    const { isCameraEnabled } = this.props;\n    const logo = isCameraEnabled ? logoEnabled : logoDisabled;\n\n    return (\n      <button onClick={this.props.toggleCameraMuting} className=\"camera-muting\">\n        <img src={logo} alt=\"mute/unmute camera\" className=\"camera-muting__image\" />\n      </button>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    isCameraEnabled: store.state.isCameraEnabled,\n  }\n}\n\nconst mapDispatchToProps = (dispatch: ThunkDispatch<TStore, void, AnyAction>) => ({\n  toggleCameraMuting: () => {\n    dispatch(toggleCameraMuting());\n  },\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CameraMuting);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { AnyAction } from \"redux\";\n\nimport { TStore } from \"../store\";\nimport { switchCamera } from \"../actions\"\n\nimport logo from \"./CameraSwitching.svg\";\nimport \"./CameraSwitching.css\";\n\ninterface IProps {\n  switchCamera: any,\n}\n\nclass CameraSwitching extends React.PureComponent<IProps> {\n  render() {\n    return (\n      <button onClick={this.props.switchCamera} className=\"camera-switching\">\n        <img src={logo} alt=\"switch camera\" className=\"camera-switching__image\" />\n      </button>\n    );\n  }\n}\n\nconst mapDispatchToProps = (dispatch: ThunkDispatch<TStore, void, AnyAction>) => ({\n  switchCamera: () => {\n    dispatch(switchCamera());\n  },\n});\n\nexport default connect(null, mapDispatchToProps)(CameraSwitching);\n","import React from \"react\";\n\nimport \"./ToolItem.css\";\n\nclass ToolItem extends React.PureComponent {\n  render() {\n    const { children } = this.props;\n\n    return (\n      <li className=\"tool-item\">\n        { children }\n      </li>\n    );\n  }\n}\n\nexport default ToolItem;\n","import React from \"react\";\n\nimport AudioMuting from \"./AudioMuting\";\nimport CameraMuting from \"./CameraMuting\";\nimport CameraSwitching from \"./CameraSwitching\";\nimport ToolItem from \"./ToolItem\";\n\nimport \"./ToolList.css\";\n\nclass ToolList extends React.PureComponent {\n  render() {\n    return (\n      <ul className=\"tool-list\">\n        <ToolItem>\n          <CameraSwitching />\n        </ToolItem>\n        <ToolItem>\n          <CameraMuting />\n        </ToolItem>\n        <ToolItem>\n          <AudioMuting />\n        </ToolItem>\n      </ul>\n    );\n  }\n}\n\nexport default ToolList;\n","import React from \"react\";\n\nimport AudienceList from \"./AudienceList\";\nimport Presenter from \"./Presenter\";\nimport ToolList from \"./ToolList\";\n\nimport \"./Room.css\";\n\nclass Room extends React.PureComponent {\n  render() {\n    return (\n      <section className=\"room\">\n        <ToolList/>\n        <Presenter/>\n        <AudienceList/>\n      </section>\n    );\n  }\n}\n\nexport default Room;\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { TStore } from \"../store\";\n\nimport Participation from \"./Participation\";\nimport Room from \"./Room\";\n\nimport \"./App.css\";\n\ninterface IProps {\n  room: any\n}\n\nclass App extends React.PureComponent<IProps> {\n  render() {\n    return (\n      <React.Fragment>\n        { this.props.room ? <Room/> : <Participation/> }\n      </React.Fragment>\n    );\n  }\n}\n\nconst mapStateToProps = (store: TStore) => {\n  return {\n    room: store.state.room,\n  }\n}\n\nexport default connect(mapStateToProps)(App)\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\n\nimport { store } from \"./store\";\n\nimport App from \"./components/App\";\nimport \"./index.css\";\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>\n  , document.getElementById(\"root\")\n);\n"],"sourceRoot":""}